import*as e from"yjs";class t extends class{constructor(){this.version="0.1.0",this.ydoc=new e.Doc,document.addEventListener("CSDT-y-update",t=>{e.applyUpdate(this.ydoc,t.detail)})}}{constructor(e){super(),this.iframe=e,this.ydoc.on("update",(e,t,n,i)=>{const s=new CustomEvent("CSDT-y-update",{detail:e});this.iframe.contentDocument.dispatchEvent(s)})}checkSupport(){return new Promise((e,t)=>{window.document.addEventListener("CSDT-response-check-support",t=>e(t.detail),{once:!0});const n=new CustomEvent("CSDT-check-support");this.iframe.contentDocument.dispatchEvent(n)})}openPortal(e=!1,t=!1){return new Promise((n,i)=>{window.document.addEventListener("CSDT-response-portal-open",e=>n(e.detail),{once:!0});const s=new CustomEvent("CSDT-portal-open",{detail:{recievesThree:e,sendsThree:t}});this.iframe.contentDocument.dispatchEvent(s)})}}AFRAME.registerComponent("csdt-portal",{schema:{href:{default:""},title:{default:""},width:{default:1.5},height:{default:2.4},frameWidth:{default:.15},enableFrame:{default:!0}},init:function(){const e=this.el,n=this.data;n.siteSendsThree=!1,n.siteRecievesThree=!1,n.has_iframe_loaded=!1,e.object3D.position.y+=n.height/2;const i=document.createElement("a-text");if(i.setAttribute("value",n.title),i.setAttribute("position",`0 ${.5*n.height+.25+n.frameWidth} 0`),i.setAttribute("align","center"),i.setAttribute("side","double"),e.appendChild(i),1==n.enableFrame){const t=n.frameWidth,i=n.width,s=n.height,o=document.createElement("a-box");o.setAttribute("position",(i+t)/2+" 0 0"),o.setAttribute("scale",`${t} ${s} ${t}`),e.appendChild(o);const a=document.createElement("a-box");a.setAttribute("position",-(i+t)/2+" 0 0"),a.setAttribute("scale",`${t} ${s} ${t}`),e.appendChild(a);const r=document.createElement("a-box");r.setAttribute("position",`0 ${(s+t)/2} 0`),r.setAttribute("scale",`${i+2*t} ${t} ${t}`),e.appendChild(r);const d=document.createElement("a-box");d.setAttribute("position","0 0 "+(-t/4-.01)),d.setAttribute("scale",`${i+2*t} ${s+2*t} ${t/2}`),e.appendChild(d)}const s=document.createElement("iframe");s.src=n.url,document.body.appendChild(s),s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.overflow="none",s.style.display="none",e.iframe=s,e.addEventListener("iframe loaded",()=>{s.addEventListener("load",()=>{const e=this.CSDT=new t(s);e.checkSupport().then(()=>{e.openPortal(!0,!0,!0).then(e=>{console.log(e),1==e.sendsThree&&(n.siteSendsThree=!0),1==e.recievesThree&&(n.siteRecievesThree=!0)})})})})},tick:function(){const e=this.el,t=this.data;if(0==t.has_iframe_loaded&&e.websurface_iframe&&e.websurface_iframe.contentDocument&&(t.has_iframe_loaded=!0,e.emit("iframe loaded")),1==t.siteRecievesThree){const t=e.sceneEl.object3D.clone();t.children=t.children.filter(e=>{}),Math.random()>.99&&console.log(t.children)}}}),AFRAME.registerComponent("csdt-receiver-portal",{schema:{title:{default:"Return to Parent"},width:{default:1.5},height:{default:2.4},frameWidth:{default:.15},enableFrame:{default:!0}},init:function(){const e=window.CSDT,t=this.el,n=this.data;n.parentRecievesThree=!1,n.parentSendsThree=!1,t.object3D.position.y+=n.height/2;const i=document.createElement("a-text");if(i.setAttribute("value",n.title),i.setAttribute("position",`0 ${.5*n.height+.25+n.frameWidth} 0`),i.setAttribute("align","center"),i.setAttribute("side","double"),t.appendChild(i),1==n.enableFrame){const e=n.frameWidth,i=n.width,s=n.height,o=document.createElement("a-box");o.setAttribute("position",(i+e)/2+" 0 0"),o.setAttribute("scale",`${e} ${s} ${e}`),t.appendChild(o);const a=document.createElement("a-box");a.setAttribute("position",-(i+e)/2+" 0 0"),a.setAttribute("scale",`${e} ${s} ${e}`),t.appendChild(a);const r=document.createElement("a-box");r.setAttribute("position",`0 ${(s+e)/2} 0`),r.setAttribute("scale",`${i+2*e} ${e} ${e}`),t.appendChild(r);const d=document.createElement("a-box");d.setAttribute("position","0 0 "+(-e/4-.01)),d.setAttribute("scale",`${i+2*e} ${s+2*e} ${e/2}`),t.appendChild(d)}t.addEventListener("CSDT-portal-open",t=>{const i=t.detail;1==i.recievesThree&&(n.parentRecievesThree=!0),1==i.sendsThree&&(n.parentSendsThree=!0),e.responsePortalOpen(!0,!0,!0)})},tick:function(){if(1==this.data.parentRecievesThree){const e=this.el.sceneEl.object3D.clone();e.children=e.children.filter(e=>{})}}});
//# sourceMappingURL=aframe-csdt-portals.modern.js.map
