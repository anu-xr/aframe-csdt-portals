{"version":3,"file":"aframe-csdt-portals.modern.js","sources":["../src/csdt/parent.js","../src/csdt/base.js","../src/csdt-portal.js","../src/csdt-receiver-portal.js"],"sourcesContent":["import Base from './base';\r\n\r\n//manages connections as a parent site\r\nexport default class CSDTParent extends Base {\r\n  constructor(iframe) {\r\n    super();\r\n\r\n    this.iframe = iframe;\r\n\r\n    //ydoc send updates\r\n    this.ydoc.on('update', (update, _origin, _doc, _tr) => {\r\n      const event = new CustomEvent('CSDT-y-update', { detail: update });\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  //returns a promise that resolves if the child site supports CSDT\r\n  //resolves with the child CSDT version number\r\n  checkSupport() {\r\n    return new Promise((resolve, _reject) => {\r\n      window.document.addEventListener('CSDT-response-check-support', (e) => resolve(e.detail), { once: true });\r\n\r\n      const event = new CustomEvent('CSDT-check-support');\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  //returns a promise that resolves with data from the child site\r\n  openPortal(recievesThree = false, sendsThree = false) {\r\n    return new Promise((resolve, _reject) => {\r\n      window.document.addEventListener('CSDT-response-portal-open', (e) => resolve(e.detail), { once: true });\r\n\r\n      const data = {\r\n        recievesThree: recievesThree,\r\n        sendsThree: sendsThree,\r\n      };\r\n      const event = new CustomEvent('CSDT-portal-open', { detail: data });\r\n      this.iframe.contentDocument.dispatchEvent(event);\r\n    });\r\n  }\r\n}\r\n","import * as Y from 'yjs';\r\n\r\n//base CSDT object\r\n//both the parent and child implementation extend from this\r\nexport default class Base {\r\n  constructor() {\r\n    this.version = '0.1.0';\r\n    this.ydoc = new Y.Doc();\r\n\r\n    //ydoc recieve updates\r\n    document.addEventListener('CSDT-y-update', (e) => {\r\n      const update = e.detail;\r\n      Y.applyUpdate(this.ydoc, update);\r\n    });\r\n  }\r\n}\r\n","import CSDTParent from './csdt/parent';\r\n\r\nAFRAME.registerComponent('csdt-portal', {\r\n  schema: {\r\n    href: { default: '' },\r\n    title: { default: '' },\r\n    width: { default: 1.5 },\r\n    height: { default: 2.4 },\r\n    frameWidth: { default: 0.15 },\r\n    enableFrame: { default: true },\r\n  },\r\n\r\n  init: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    data.siteSendsThree = false;\r\n    data.siteRecievesThree = false;\r\n    data.has_iframe_loaded = false;\r\n    el.object3D.position.y += data.height / 2;\r\n\r\n    //portal title\r\n    const title = document.createElement('a-text');\r\n    title.setAttribute('value', data.title);\r\n    title.setAttribute('position', `0 ${data.height * 0.5 + 0.25 + data.frameWidth} 0`);\r\n    title.setAttribute('align', 'center');\r\n    title.setAttribute('side', 'double');\r\n    el.appendChild(title);\r\n\r\n    //portal frame\r\n    if (data.enableFrame == true) {\r\n      const frameWidth = data.frameWidth;\r\n      const width = data.width;\r\n      const height = data.height;\r\n\r\n      const box1 = document.createElement('a-box');\r\n      box1.setAttribute('position', `${(width + frameWidth) / 2} 0 0`);\r\n      box1.setAttribute('scale', `${frameWidth} ${height} ${frameWidth}`);\r\n      el.appendChild(box1);\r\n\r\n      const box2 = document.createElement('a-box');\r\n      box2.setAttribute('position', `${-(width + frameWidth) / 2} 0 0`);\r\n      box2.setAttribute('scale', `${frameWidth} ${height} ${frameWidth}`);\r\n      el.appendChild(box2);\r\n\r\n      const box3 = document.createElement('a-box');\r\n      box3.setAttribute('position', `0 ${(height + frameWidth) / 2} 0`);\r\n      box3.setAttribute('scale', `${width + frameWidth * 2} ${frameWidth} ${frameWidth}`);\r\n      el.appendChild(box3);\r\n\r\n      const box4 = document.createElement('a-box');\r\n      box4.setAttribute('position', `0 0 ${-frameWidth / 4 - 0.01}`);\r\n      box4.setAttribute('scale', `${width + frameWidth * 2} ${height + frameWidth * 2} ${frameWidth / 2}`);\r\n      el.appendChild(box4);\r\n    }\r\n\r\n    //create iframe\r\n    const iframe = document.createElement('iframe');\r\n    iframe.src = data.url;\r\n    document.body.appendChild(iframe);\r\n\r\n    iframe.style.position = 'fixed';\r\n    iframe.style.top = '0';\r\n    iframe.style.left = '0';\r\n    iframe.style.width = '100%';\r\n    iframe.style.height = '100%';\r\n    iframe.style.overflow = 'none';\r\n    iframe.style.display = 'none';\r\n\r\n    el.iframe = iframe;\r\n\r\n    //set up CSDT\r\n    el.addEventListener('iframe loaded', () => {\r\n      iframe.addEventListener('load', () => {\r\n        const CSDT = (this.CSDT = new CSDTParent(iframe));\r\n\r\n        //check for CSDT supprt\r\n        CSDT.checkSupport().then(() => {\r\n          //open a portal\r\n          CSDT.openPortal(true, true, true).then((d) => {\r\n            console.log(d);\r\n            if (d.sendsThree == true) {\r\n              //if the child site supports sending us threejs data\r\n              data.siteSendsThree = true;\r\n            }\r\n            if (d.recievesThree == true) {\r\n              //if the child site supports recieving threejs data from us\r\n              data.siteRecievesThree = true;\r\n            }\r\n          });\r\n        });\r\n      });\r\n    });\r\n  },\r\n\r\n  tick: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    if (data.has_iframe_loaded == false) {\r\n      if (el.websurface_iframe) {\r\n        if (el.websurface_iframe.contentDocument) {\r\n          data.has_iframe_loaded = true;\r\n          el.emit('iframe loaded');\r\n        }\r\n      }\r\n    }\r\n\r\n    if (data.siteRecievesThree == true) {\r\n      //send our three scene to the site\r\n      const scene = el.sceneEl.object3D.clone();\r\n      scene.children = scene.children.filter((child) => {\r\n        child.el.id !== 'player';\r\n      });\r\n      if (Math.random() > 0.99) console.log(scene.children);\r\n    }\r\n  },\r\n});\r\n","AFRAME.registerComponent('csdt-receiver-portal', {\r\n  schema: {\r\n    title: { default: 'Return to Parent' },\r\n    width: { default: 1.5 },\r\n    height: { default: 2.4 },\r\n    frameWidth: { default: 0.15 },\r\n    enableFrame: { default: true },\r\n  },\r\n\r\n  init: function () {\r\n    const CSDT = window.CSDT;\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    data.parentRecievesThree = false;\r\n    data.parentSendsThree = false;\r\n\r\n    el.object3D.position.y += data.height / 2;\r\n\r\n    //portal title\r\n    const title = document.createElement('a-text');\r\n    title.setAttribute('value', data.title);\r\n    title.setAttribute('position', `0 ${data.height * 0.5 + 0.25 + data.frameWidth} 0`);\r\n    title.setAttribute('align', 'center');\r\n    title.setAttribute('side', 'double');\r\n    el.appendChild(title);\r\n\r\n    //portal frame\r\n    if (data.enableFrame == true) {\r\n      const frameWidth = data.frameWidth;\r\n      const width = data.width;\r\n      const height = data.height;\r\n\r\n      const box1 = document.createElement('a-box');\r\n      box1.setAttribute('position', `${(width + frameWidth) / 2} 0 0`);\r\n      box1.setAttribute('scale', `${frameWidth} ${height} ${frameWidth}`);\r\n      el.appendChild(box1);\r\n\r\n      const box2 = document.createElement('a-box');\r\n      box2.setAttribute('position', `${-(width + frameWidth) / 2} 0 0`);\r\n      box2.setAttribute('scale', `${frameWidth} ${height} ${frameWidth}`);\r\n      el.appendChild(box2);\r\n\r\n      const box3 = document.createElement('a-box');\r\n      box3.setAttribute('position', `0 ${(height + frameWidth) / 2} 0`);\r\n      box3.setAttribute('scale', `${width + frameWidth * 2} ${frameWidth} ${frameWidth}`);\r\n      el.appendChild(box3);\r\n\r\n      const box4 = document.createElement('a-box');\r\n      box4.setAttribute('position', `0 0 ${-frameWidth / 4 - 0.01}`);\r\n      box4.setAttribute('scale', `${width + frameWidth * 2} ${height + frameWidth * 2} ${frameWidth / 2}`);\r\n      el.appendChild(box4);\r\n    }\r\n\r\n    //set up CSDT\r\n    el.addEventListener('CSDT-portal-open', (e) => {\r\n      const d = e.detail;\r\n\r\n      if (d.recievesThree == true) {\r\n        data.parentRecievesThree = true;\r\n      }\r\n      if (d.sendsThree == true) {\r\n        data.parentSendsThree = true;\r\n      }\r\n\r\n      //send info back to parent\r\n      CSDT.responsePortalOpen(true, true, true);\r\n    });\r\n  },\r\n\r\n  tick: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    if (data.parentRecievesThree == true) {\r\n      //send our three scene to the parent\r\n      const scene = el.sceneEl.object3D.clone();\r\n      scene.children = scene.children.filter((child) => {\r\n        child.el.id !== 'player';\r\n      });\r\n    }\r\n  },\r\n});\r\n"],"names":["CSDTParent","constructor","this","version","ydoc","Y","Doc","document","addEventListener","e","applyUpdate","detail","iframe","super","on","update","_origin","_doc","_tr","event","CustomEvent","contentDocument","dispatchEvent","checkSupport","Promise","resolve","_reject","window","once","openPortal","recievesThree","sendsThree","AFRAME","registerComponent","schema","href","default","title","width","height","frameWidth","enableFrame","init","el","data","siteSendsThree","siteRecievesThree","has_iframe_loaded","object3D","position","y","createElement","setAttribute","appendChild","box1","box2","box3","box4","src","url","body","style","top","left","overflow","display","CSDT","then","d","console","log","tick","websurface_iframe","emit","scene","sceneEl","clone","children","filter","child","Math","random","parentRecievesThree","parentSendsThree","responsePortalOpen"],"mappings":"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"}